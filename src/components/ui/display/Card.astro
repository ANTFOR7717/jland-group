---
// Card Component - Reusable card with multiple variants
// Adheres to Tailwind CSS only styling as required

export interface Props {
  variant?: 'default' | 'service' | 'testimonial' | 'roofing' | 'construction' | 'review' | 'image' | 'quote' | 'showcase';
  class?: string;
  // Service/Roofing variant specific props
  image?: string;
  imageAlt?: string;
  title?: string;
  description?: string;
  buttonText?: string;
  buttonHref?: string;
  // Review variant specific props
  customerName?: string;
  location?: string;
  rating?: number;
  serviceType?: string;
  reviewText?: string;
  timeAgo?: string;
  // Image variant specific props
  backgroundImage?: string;
  width?: string;
  height?: string;
  // Quote variant specific props
  quoteWidth?: 'sm' | 'md' | 'lg';
}

const {
  variant = 'default',
  class: className = '',
  image,
  imageAlt,
  title = 'Get Your Free Quote',
  description,
  buttonText = 'Learn More',
  buttonHref = '#',
  customerName,
  location,
  rating,
  serviceType,
  reviewText,
  timeAgo,
  backgroundImage,
  width,
  height,
  quoteWidth = 'md',
  ...rest
} = Astro.props;

import Heading from './Heading.astro';
import Text from './Text.astro';
import StarRating from './StarRating.astro';
import Badge from './Badge.astro';
import Icon from './Icon.astro';

// Base classes for all cards
const baseClasses = 'bg-white overflow-hidden';

// Quote width classes
const quoteWidthClasses = {
  sm: 'w-[280px]',
  md: 'w-[316px]',
  lg: 'w-[400px]'
};

// Variant-specific classes (without width/height to avoid conflicts)
const variantClasses = {
  default: 'shadow-lg border border-brand-border p-6 rounded-xl',
  service: 'shadow-lg border border-brand-border flex flex-col items-stretch flex-shrink-0 p-6 rounded-xl',
  roofing: 'shadow-lg border border-brand-border flex flex-col items-stretch flex-shrink-0 p-6 rounded-xl',
  construction: 'shadow-lg border border-brand-border flex flex-col items-stretch flex-shrink-0 p-6 rounded-xl',
  showcase: 'shadow-lg border border-brand-border flex flex-col items-stretch flex-shrink-0 p-6 rounded-xl',
  testimonial: 'shadow-md border border-brand-border p-5 flex flex-col rounded-xl',
  review: 'shadow-md border border-brand-border p-5 flex flex-col rounded-xl',
  image: 'shadow-lg rounded-lg bg-cover',
  quote: `shadow-md shadow-black/10 rounded-lg p-6 flex-shrink-0 ${quoteWidthClasses[quoteWidth]}`
};

// Default width classes for variants when no custom width is provided
const defaultWidthClasses = {
  service: width ? '' : 'w-full max-w-sm',
  roofing: width ? '' : 'w-full max-w-sm',
  construction: width ? '' : 'w-full max-w-sm',
  showcase: width ? '' : 'w-full max-w-sm',
  review: width ? '' : 'w-full max-w-none sm:max-w-[576px]',
  default: '',
  testimonial: '',
  image: '',
  quote: ''
};

// Apply custom height and width if provided, otherwise use defaults
const sizeClasses = `${height ? height : ''} ${width ? width : defaultWidthClasses[variant] || ''}`;
const cardClasses = `${baseClasses} ${variantClasses[variant]} ${sizeClasses} ${className}`.trim().replace(/\s+/g, ' ');
---

<div class={cardClasses} style={variant === 'image' && backgroundImage ? `background-image: url('${backgroundImage}'); margin-left: 0.16px;` : undefined} {...rest}>
  {variant === 'image' ? (
    <slot />
  ) : variant === 'quote' ? (
    <>
      {title && (
        <Heading level={3} class="mb-4" color="default">{title}</Heading>
      )}
      <slot />
    </>
  ) : (variant === 'service' || variant === 'roofing' || variant === 'construction' || variant === 'showcase') && image && title && description ? (
    <div class="space-y-4">
      <img src={image} alt={imageAlt} class="w-full h-48 object-cover rounded-lg" />
      
      <div class="space-y-3">
        <Heading level={3} size="xl" color="default">
          {title}
        </Heading>
        
        <Text variant="body" color="default">
          {description}
        </Text>
        
        <a 
          href={buttonHref}
          class="inline-flex items-center font-medium transition-colors"
          style="color: #262327;"
        >
          {buttonText}
          <svg class="w-4 h-4 ml-2" fill="none" stroke="#FDB813" stroke-width="2" viewBox="0 0 24 24">
            <path d="M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.41z"></path>
          </svg>
        </a>
      </div>
    </div>
  ) : variant === 'review' && customerName && location && rating !== undefined && serviceType && reviewText && timeAgo ? (
    <div>
      <!-- Customer Name and Rating Header -->
      <div class="flex justify-between w-[536px]">
        <Text color="default" weight="semibold" class="min-h-6 leading-6">
          {customerName}
        </Text>
        <div class="pb-[9.78px]">
          <StarRating rating={rating} variant="review" size="sm" />
        </div>
      </div>
      
      <!-- Location -->
      <Text variant="small" color="secondary" class="min-h-5">
        {location}
      </Text>
      
      <!-- Service Badge and Verification -->
      <div class="flex items-center mt-2 gap-1">
        <Badge variant="service" size="sm" class="w-[120px] px-2 py-1 flex items-center justify-center">
          <Text variant="caption" color="default" class="w-[104px] min-h-4">
            {serviceType}
          </Text>
        </Badge>
        <Icon name="verified" size="xs" class="mt-1.5 ml-1" />
        <Text variant="caption" color="secondary" class="w-full max-w-none sm:w-[103.1px] mt-1 min-h-4">
          Verified Customer
        </Text>
      </div>
      
      <!-- Review Text -->
      <Text color="default" class="w-full max-w-none sm:w-[507.1px] mt-3 sm:mr-[28.9px] min-h-12 leading-6">
        {reviewText}
      </Text>
      
      <!-- Time Ago -->
      <Text variant="caption" color="secondary" class="w-[72px] mt-2 min-h-4">
        {timeAgo}
      </Text>
    </div>
  ) : (
    <slot />
  )}
</div>