---
import { getEntry } from 'astro:content';
import Layout from '../layouts/Layout.astro';

import Button from '../components/ui/buttons/Button.astro';
import Container from '../components/ui/layout/Container.astro';
import Section from '../components/ui/layout/Section.astro';
import SectionHeader from '../components/ui/display/SectionHeader.astro';
import Text from '../components/ui/display/Text.astro';

const page = (await getEntry('pages', 'blog'))!;
const { 
  title: pageTitle, 
  description: pageDescription, 
  badge, 
  hero_heading, 
  hero_heading_accent, 
  hero_subtitle, 
  cta_primary_text, 
  cta_primary_href, 
  cta_secondary_text, 
  cta_secondary_href, 
  trust_indicators, 
  categories,
  category_labels,
  blog_articles,
  sidebar_recent_posts_title,
  sidebar_categories_title,
  sidebar_categories,
  sidebar_trust_title,
  sidebar_trust_items,
  sidebar_cta_title,
  sidebar_cta_text,
  sidebar_cta_button,
  sidebar_cta_href,
  sidebar_contact_title,
  sidebar_contact_info,
  bottom_cta_heading,
  bottom_cta_text,
  bottom_cta_primary_text,
  bottom_cta_primary_href,
  bottom_cta_secondary_text,
  bottom_cta_secondary_href,
} = page.data as any;

const recentPosts = blog_articles.slice(0, 3);
---

<Layout title={pageTitle} description={pageDescription}>
  
  <!-- Hero Section -->
  <Section background="dark">
    <Container>
      <div class="text-center max-w-4xl mx-auto">
        <div class="mb-6">
          <div class="inline-flex items-center justify-center mb-4 text-white bg-brand-primary px-4 py-2 rounded-full font-semibold">
            {badge}
          </div>
        </div>
        <h1 class="text-5xl md:text-6xl font-bold text-white mb-6 leading-tight">
          {hero_heading}<br>
          <span class="text-accent-primary">{hero_heading_accent}</span>
        </h1>
        <p class="text-xl text-white mb-8 leading-relaxed">
          {hero_subtitle}
        </p>
        <div class="flex flex-col sm:flex-row gap-4 justify-center items-center mb-8">
          <Button href={cta_primary_href} variant="primary" size="lg">
            {cta_primary_text}
          </Button>
          <Button href={cta_secondary_href} variant="primary" size="lg" class="bg-white text-brand-primary border-white hover:bg-gray-100">
            {cta_secondary_text}
          </Button>
        </div>
        <div class="flex flex-wrap justify-center gap-6 text-sm text-white">
            {trust_indicators?.map((indicator: string) => (
            <div class="flex items-center gap-2">
              <svg class="w-5 h-5 text-accent-primary" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
              </svg>
              <span>{indicator}</span>
            </div>
            ))}

        </div>
      </div>
    </Container>
  </Section>

  <!-- Blog Content Section -->
  <Section class="py-16 lg:py-24 bg-background-light" id="articles">
    <Container>
      <div class="grid lg:grid-cols-3 gap-12">
        
        <!-- Main Content - Article Grid -->
        <div class="lg:col-span-2">
          <!-- Category Filter -->
          <div class="mb-8">
            <div class="flex flex-wrap gap-2" id="category-filters">
              {categories?.map((cat: any) => (
                <button
                  data-category={cat.id}
                  class="category-btn px-5 py-2.5 rounded-lg font-semibold text-sm transition-all duration-200 border shadow-sm hover:shadow-md focus:outline-none focus:ring-2 focus:ring-accent-primary focus:ring-offset-2"
                  class:list={[cat.id === "all" ? "bg-accent-primary text-brand-primary border-accent-primary shadow-accent" : "bg-white text-brand-secondary border-brand-border hover:border-accent-primary hover:text-accent-primary"]}
                >
                  {cat.label}
                </button>
              ))}
            </div>
          </div>

          <!-- Article Grid -->
          <div class="grid md:grid-cols-2 gap-6" id="articles-grid">
            {blog_articles?.map((article: any) => (
              <article 
                class="article-card bg-white rounded-2xl shadow-lg border border-brand-border overflow-hidden group hover:shadow-xl transition-shadow duration-300"
                data-category={article.category}
              >
                <!-- Thumbnail Placeholder -->
                <div class="h-48 bg-background-light flex items-center justify-center relative overflow-hidden">
                  <div class="w-20 h-20 bg-accent-primary/20 rounded-full flex items-center justify-center">
                    <svg class="w-10 h-10 text-accent-primary" fill="currentColor" viewBox="0 0 20 20">
                      <path fill-rule="evenodd" d="M4 3a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V5a2 2 0 00-2-2H4zm12 12H4l4-8 3 6 2-4 3 6z" clip-rule="evenodd"></path>
                    </svg>
                  </div>
                  <!-- Category Badge -->
                  <div class="absolute top-4 left-4">
                    <span class="px-3 py-1.5 bg-accent-primary text-brand-primary text-xs font-bold rounded-lg shadow-sm">
                      {category_labels[article.category]}
                    </span>
                  </div>
                </div>
                
                <!-- Article Content -->
                <div class="p-6">
                  <p class="text-sm text-brand-secondary mb-2">{article.date}</p>
                  <h3 class="text-xl font-bold text-brand-primary mb-3 group-hover:text-accent-primary transition-colors line-clamp-2">
                    {article.title}
                  </h3>
                  <p class="text-brand-secondary mb-4 line-clamp-3 leading-relaxed">
                    {article.excerpt}
                  </p>
                  <a 
                    href={`/blog/${article.slug}`}
                    class="inline-flex items-center text-accent-primary font-semibold hover:text-accent-secondary transition-colors"
                  >
                    Read More
                    <svg class="w-4 h-4 ml-2" fill="currentColor" viewBox="0 0 20 20">
                      <path fill-rule="evenodd" d="M10.293 3.293a1 1 0 011.414 0l6 6a1 1 0 010 1.414l-6 6a1 1 0 01-1.414-1.414L14.586 11H3a1 1 0 110-2h11.586l-4.293-4.293a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                  </a>
                </div>
              </article>
            ))}
          </div>

          <!-- No Results Message -->
          <div id="no-results" class="hidden text-center py-12">
            <svg class="w-16 h-16 text-brand-secondary mx-auto mb-4" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
            </svg>
            <p class="text-brand-secondary text-lg">No articles found in this category.</p>
            <button 
              class="mt-4 text-accent-primary font-semibold hover:text-accent-secondary"
              onclick="resetFilters()"
            >
              View all articles
            </button>
          </div>
        </div>

        <!-- Sidebar -->
        <aside class="lg:col-span-1 space-y-8">
          
          <!-- Recent Posts Widget -->
          <div class="bg-white rounded-2xl shadow-xl border border-brand-border p-8">
            <h3 class="text-xl font-bold text-brand-primary mb-6 flex items-center">
              <svg class="w-5 h-5 mr-3 text-accent-primary" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
              </svg>
              {sidebar_recent_posts_title}
            </h3>
            <div class="space-y-4">
              {recentPosts?.map((post: any) => (
                <a 
                  href={`/blog/${post.slug}`}
                  class="block group py-2 border-b border-gray-100 last:border-0"
                >
                  <p class="font-medium text-brand-primary group-hover:text-accent-primary transition-colors line-clamp-2">
                    {post.title}
                  </p>
                  <p class="text-sm text-brand-secondary mt-1">{post.date}</p>
                </a>
              ))}
            </div>
          </div>

          <!-- Service Categories Widget -->
          <div class="bg-white rounded-2xl shadow-xl border border-brand-border p-8">
            <h3 class="text-xl font-bold text-brand-primary mb-6 flex items-center">
              <svg class="w-5 h-5 mr-3 text-accent-primary" fill="currentColor" viewBox="0 0 20 20">
                <path d="M7 3a1 1 0 000 2h6a1 1 0 100-2H7zM4 7a1 1 0 011-1h10a1 1 0 110 2H5a1 1 0 01-1-1zM2 11a2 2 0 012-2h12a2 2 0 012 2v4a2 2 0 01-2 2H4a2 2 0 01-2-2v-4z"></path>
              </svg>
              {sidebar_categories_title}
            </h3>
            <nav class="space-y-1">
              {sidebar_categories?.map((cat: any) => (
                <a href={cat.href} class="flex items-center text-brand-secondary hover:text-accent-primary transition-colors py-3 border-b border-gray-100 last:border-0">
                  <svg class="w-4 h-4 mr-3 text-accent-primary" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                  </svg>
                  {cat.label}
                </a>
              ))}
            </nav>
          </div>

          <!-- Trust Badges -->
          <div class="bg-white rounded-2xl shadow-xl border border-brand-border p-8">
            <h3 class="text-xl font-bold text-brand-primary mb-6 flex items-center">
              <svg class="w-5 h-5 mr-3 text-accent-primary" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M6.267 3.455a3.066 3.066 0 001.745-.723 3.066 3.066 0 013.976 0 3.066 3.066 0 001.745.723 3.066 3.066 0 012.812 2.812c.051.643.304 1.254.723 1.745a3.066 3.066 0 010 3.976 3.066 3.066 0 00-.723 1.745 3.066 3.066 0 01-2.812 2.812 3.066 3.066 0 00-1.745.723 3.066 3.066 0 01-3.976 0 3.066 3.066 0 00-1.745-.723 3.066 3.066 0 01-2.812-2.812 3.066 3.066 0 00-.723-1.745 3.066 3.066 0 010-3.976 3.066 3.066 0 00.723-1.745 3.066 3.066 0 012.812-2.812zm7.44 5.252a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
              </svg>
              {sidebar_trust_title}
            </h3>
            <div class="space-y-4">
              {sidebar_trust_items?.map((item: any) => (
                <div class="flex items-center">
                  <div class={`w-12 h-12 ${item.color} rounded-full flex items-center justify-center mr-4 flex-shrink-0`}>
                    <svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 20 20">
                      {item.icon === 'shield' && <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>}
                      {item.icon === 'certificate' && <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path>}
                      {item.icon === 'users' && <path fill-rule="evenodd" d="M3.172 5.172a4 4 0 015.656 0L10 6.343l1.172-1.171a4 4 0 115.656 5.656L10 17.657l-6.828-6.829a4 4 0 010-5.656z" clip-rule="evenodd"></path>}
                    </svg>
                  </div>
                  <div>
                    <p class="font-semibold text-brand-primary">{item.title}</p>
                    <p class="text-sm text-brand-secondary">{item.subtitle}</p>
                  </div>
                </div>
              ))}
            </div>
          </div>

          <!-- CTA Widget -->
          <div class="bg-brand-primary rounded-2xl shadow-xl p-8 text-center">
            <h3 class="text-2xl font-bold text-white mb-4">{sidebar_cta_title}</h3>
            <p class="text-white/90 mb-6 leading-relaxed">
              {sidebar_cta_text}
            </p>
            <Button href={sidebar_cta_href} variant="primary" size="md" class="w-full justify-center">
              {sidebar_cta_button}
            </Button>
          </div>

          <!-- Contact Info -->
          <div class="bg-white rounded-2xl shadow-xl border border-brand-border p-8">
            <h3 class="text-xl font-bold text-brand-primary mb-6 flex items-center">
              <svg class="w-5 h-5 mr-3 text-accent-primary" fill="currentColor" viewBox="0 0 20 20">
                <path d="M2 3a1 1 0 011-1h2.153a1 1 0 01.986.836l.74 4.435a1 1 0 01-.54 1.06l-1.548.773a11.037 11.037 0 006.105 6.105l.774-1.548a1 1 0 011.059-.54l4.435.74a1 1 0 01.836.986V17a1 1 0 01-1 1h-2C7.82 18 2 12.18 2 5V3z"></path>
              </svg>
              {sidebar_contact_title}
            </h3>
            <div class="space-y-4">
              <div class="flex items-start">
                <svg class="w-5 h-5 text-accent-primary mr-4 mt-0.5 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                  <path d="M2 3a1 1 0 011-1h2.153a1 1 0 01.986.836l.74 4.435a1 1 0 01-.54 1.06l-1.548.773a11.037 11.037 0 006.105 6.105l.774-1.548a1 1 0 011.059-.54l4.435.74a1 1 0 01.836.986V17a1 1 0 01-1 1h-2C7.82 18 2 12.18 2 5V3z"></path>
                </svg>
                <div>
                  <p class="font-semibold text-brand-primary">{sidebar_contact_info.phone}</p>
                  <p class="text-sm text-brand-secondary">{sidebar_contact_info.hours}</p>
                </div>
              </div>
              <div class="flex items-start">
                <svg class="w-5 h-5 text-accent-primary mr-4 mt-0.5 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                  <path d="M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884z"></path>
                  <path d="M18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z"></path>
                </svg>
                <div>
                  <p class="font-semibold text-brand-primary">{sidebar_contact_info.email}</p>
                </div>
              </div>
              <div class="flex items-start">
                <svg class="w-5 h-5 text-accent-primary mr-4 mt-0.5 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z" clip-rule="evenodd"></path>
                </svg>
                <div>
                  <p class="font-semibold text-brand-primary">{sidebar_contact_info.areas_title}</p>
                  <p class="text-sm text-brand-secondary">{sidebar_contact_info.areas_list}</p>
                </div>
              </div>
            </div>
          </div>
        </aside>
      </div>
    </Container>
  </Section>

  <!-- CTA Section -->
  <Section background="dark">
    <Container>
      <div class="text-center max-w-4xl mx-auto">
        <h2 class="text-3xl sm:text-4xl md:text-5xl font-bold mb-6 text-white">
          {bottom_cta_heading?.split('Lighting')[0]} {bottom_cta_heading?.includes('Roofing Project') && 'Ready for Your'} <span class="text-accent-primary">{bottom_cta_heading?.includes('Roofing Project') ? 'Roofing Project?' : ''}</span>
        </h2>
        <p class="text-xl mb-8 text-white leading-relaxed">
          {bottom_cta_text}
        </p>
        <div class="flex flex-col sm:flex-row gap-4 justify-center">
          <Button href={bottom_cta_primary_href} variant="primary" size="lg">
            {bottom_cta_primary_text}
          </Button>
          <Button href={bottom_cta_secondary_href} variant="primary" size="lg" class="bg-white text-brand-primary border-white hover:bg-gray-100">
            {bottom_cta_secondary_text}
          </Button>
        </div>
      </div>
    </Container>
  </Section>
</Layout>

<style>
  .line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
  
  .line-clamp-3 {
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
  
  .article-card.hidden {
    display: none;
  }
  
  .category-btn.active {
    background-color: rgb(253, 184, 19);
    color: rgb(38, 35, 39);
    border-color: rgb(253, 184, 19);
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const filterButtons = document.querySelectorAll('.category-btn');
    const articleCards = document.querySelectorAll('.article-card');
    const noResults = document.getElementById('no-results');
    
    function filterArticles(category: string) {
      let visibleCount = 0;
      
      articleCards.forEach((card) => {
        const articleCategory = card.getAttribute('data-category');
        if (category === 'all' || articleCategory === category) {
          card.classList.remove('hidden');
          visibleCount++;
        } else {
          card.classList.add('hidden');
        }
      });
      
      // Show/hide no results message
      if (noResults) {
        if (visibleCount === 0) {
          noResults.classList.remove('hidden');
        } else {
          noResults.classList.add('hidden');
        }
      }
      
      // Update active button state
      filterButtons.forEach((btn) => {
        const btnCategory = btn.getAttribute('data-category');
        if (btnCategory === category) {
          btn.classList.remove('bg-white', 'text-brand-secondary');
          btn.classList.add('bg-accent-primary', 'text-brand-primary', 'border-accent-primary');
        } else {
          btn.classList.add('bg-white', 'text-brand-secondary');
          btn.classList.remove('bg-accent-primary', 'text-brand-primary', 'border-accent-primary');
        }
      });
      
      // Update URL hash
      if (category !== 'all') {
        window.location.hash = category;
      } else {
        history.pushState('', document.title, window.location.pathname + window.location.search);
      }
    }
    
    // Add click listeners to filter buttons
    filterButtons.forEach((btn) => {
      btn.addEventListener('click', () => {
        const category = btn.getAttribute('data-category') || 'all';
        filterArticles(category);
      });
    });
    
    // Check for hash on page load
    const hash = window.location.hash.substring(1);
    if (hash) {
      filterArticles(hash);
    }
  });
  
  // Global function for reset button
  function resetFilters() {
    const allBtn = document.querySelector('.category-btn[data-category="all"]');
    if (allBtn) {
      (allBtn as HTMLButtonElement).click();
    }
  }
  
  // Make resetFilters available globally
  (window as any).resetFilters = resetFilters;
</script>

<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Blog",
  "name": "J Land Contracting Blog",
  "description": "Expert insights on roofing, siding, gutters, and storm restoration from Maryland's trusted family-owned contractors.",
  "url": "https://jlandgroup.com/blog",
  "publisher": {
    "@type": "LocalBusiness",
    "name": "J Land Contracting",
    "address": {
      "@type": "PostalAddress",
      "addressLocality": "Frederick",
      "addressRegion": "MD",
      "addressCountry": "US"
    }
  },
  "blogPost": [
    {
      "@type": "BlogPosting",
      "headline": "5 Warning Signs Your Roof Needs Immediate Attention",
      "datePublished": "2025-12-10",
      "description": "Learn the critical indicators that your roof may need repairs or replacement before minor issues become major expenses."
    },
    {
      "@type": "BlogPosting",
      "headline": "How Storm Damage Insurance Claims Work in Maryland",
      "datePublished": "2025-12-05",
      "description": "Navigate the insurance claims process with confidence. Our 15+ years of experience helping Maryland homeowners."
    }
  ]
}
</script>
